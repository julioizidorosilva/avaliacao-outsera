{
  "info": {
    "name": "API de Avaliação - Completa",
    "_postman_id": "b3f6f9d2-0000-4a5d-8c6b-xxxxxxxxxxxx",
    "description": "Coleção completa para testar todas as rotas da API Avaliacao. Variável: baseUrl = http://localhost:8080",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Descoberta e Informações da API",
      "item": [
        {
          "name": "Obter Recursos da API (GET /api)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api",
              "host": ["{{baseUrl}}"],
              "path": ["api"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function(){ pm.response.to.have.status(200); });",
                  "pm.test('Has API info', function(){ var body = pm.response.json(); pm.expect(body).to.have.property('api'); pm.expect(body).to.have.property('resources'); });"
                ]
              }
            }
          ],
          "response": []
        },
        {
          "name": "Health Check (GET /api/health)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/health",
              "host": ["{{baseUrl}}"],
              "path": ["api", "health"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function(){ pm.response.to.have.status(200); });",
                  "pm.test('Status is UP', function(){ var body = pm.response.json(); pm.expect(body.status).to.eql('UP'); });"
                ]
              }
            }
          ],
          "response": []
        },
        {
          "name": "Informações de Códigos de Status (GET /api/status-codes)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/status-codes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "status-codes"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function(){ pm.response.to.have.status(200); });",
                  "pm.test('Has status codes info', function(){ var body = pm.response.json(); pm.expect(body).to.have.property('codigosStatus'); });"
                ]
              }
            }
          ],
          "response": []
        },
        {
          "name": "OPTIONS /api (Verificação CORS)",
          "request": {
            "method": "OPTIONS",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api",
              "host": ["{{baseUrl}}"],
              "path": ["api"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function(){ pm.response.to.have.status(200); });",
                  "pm.test('Allow header exists', function(){ var allow = pm.response.headers.get('Allow'); pm.expect(allow).to.be.a('string'); });"
                ]
              }
            }
          ],
          "response": []
        }
      ]
    },
    {
      "name": "Operações de Filmes",
      "item": [
        {
          "name": "Carregar Filmes do CSV (POST /api/movies/load)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "movielist.csv",
                  "description": "Arquivo CSV com dados dos filmes"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/movies/load",
              "host": ["{{baseUrl}}"],
              "path": ["api", "movies", "load"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 201', function () { pm.response.to.have.status(201); });",
                  "pm.test('Has total count', function () { var body = pm.response.json(); pm.expect(body).to.have.property('total'); pm.expect(body.total).to.be.a('number'); });"
                ]
              }
            }
          ],
          "response": []
        },
        {
          "name": "Obter Todos os Filmes (GET /api/movies)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/movies",
              "host": ["{{baseUrl}}"],
              "path": ["api", "movies"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function(){ pm.response.to.have.status(200); });",
                  "pm.test('Response is array', function(){ pm.expect(pm.response.json()).to.be.an('array'); });",
                  "// Store first movie ID for other tests",
                  "if (pm.response.json().length > 0) {",
                  "    pm.environment.set('createdMovieId', pm.response.json()[0].id);",
                  "}"
                ]
              }
            }
          ],
          "response": []
        },
        {
          "name": "Obter Filme por ID (GET /api/movies/{id})",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/movies/{{createdMovieId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "movies", "{{createdMovieId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 or 404 if ID not set', function(){",
                  "    if(pm.environment.get('createdMovieId')) {",
                  "        pm.response.to.have.status(200);",
                  "        var body = pm.response.json();",
                  "        pm.expect(body).to.have.property('id');",
                  "        pm.expect(body).to.have.property('title');",
                  "    } else {",
                  "        pm.response.to.have.status(404);",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "response": []
        },
        {
          "name": "Obter Filme por ID - Não Encontrado (GET /api/movies/999999)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/movies/999999",
              "host": ["{{baseUrl}}"],
              "path": ["api", "movies", "999999"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 404', function(){ pm.response.to.have.status(404); });"
                ]
              }
            }
          ],
          "response": []
        },
        {
          "name": "Obter Intervalos de Produtores (GET /api/movies/producers/intervals)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/movies/producers/intervals",
              "host": ["{{baseUrl}}"],
              "path": ["api", "movies", "producers", "intervals"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function(){ pm.response.to.have.status(200); });",
                  "pm.test('Has min & max arrays', function(){ ",
                  "    var body = pm.response.json(); ",
                  "    pm.expect(body).to.have.property('min'); ",
                  "    pm.expect(body).to.have.property('max'); ",
                  "    pm.expect(body.min).to.be.an('array'); ",
                  "    pm.expect(body.max).to.be.an('array'); ",
                  "});"
                ]
              }
            }
          ],
          "response": []
        },
        {
          "name": "OPTIONS /api/movies (Verificação CORS)",
          "request": {
            "method": "OPTIONS",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/movies",
              "host": ["{{baseUrl}}"],
              "path": ["api", "movies"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function(){ pm.response.to.have.status(200); });",
                  "pm.test('Allow header contains GET', function(){ ",
                  "    var allow = pm.response.headers.get('Allow'); ",
                  "    if (allow) {",
                  "        pm.expect(allow).to.include('GET'); ",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "response": []
        }
      ]
    },
    {
      "name": "Testes de Erro",
      "item": [
        {
          "name": "ID de Filme Inválido - String (GET /api/movies/invalid)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/movies/invalid",
              "host": ["{{baseUrl}}"],
              "path": ["api", "movies", "invalid"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400 or 404', function(){ ",
                  "    pm.expect([400, 404]).to.include(pm.response.code); ",
                  "});"
                ]
              }
            }
          ],
          "response": []
        },
        {
          "name": "Upload de CSV Vazio (POST /api/movies/load)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "body": {
              "mode": "formdata",
              "formdata": []
            },
            "url": {
              "raw": "{{baseUrl}}/api/movies/load",
              "host": ["{{baseUrl}}"],
              "path": ["api", "movies", "load"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400', function(){ pm.response.to.have.status(400); });",
                  "pm.test('Has error message', function(){ ",
                  "    var body = pm.response.json(); ",
                  "    pm.expect(body).to.have.property('erro'); ",
                  "});"
                ]
              }
            }
          ],
          "response": []
        }
      ]
    }
  ]
}
